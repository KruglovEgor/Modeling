# Отчет по лабораторной работе №3

Тема: Моделирование процессов в SimPy (Микросервис обработки изображений)

## Вариант и исходные данные
- Количество устройств (GPU‑воркеров): s = 4  
- Среднее время инференса (обслуживания): μ_s = 1.5 сек  
- Среднее время межприхода (поступления запросов): μ_A = 1.5 сек  
- Аналог системы: микросервис обработки изображений с быстрым шагом предобработки и пулом GPU‑воркеров.

## Постановка задачи
Разработать имитационную модель СМО с использованием SimPy, построить и рассчитать выходные параметры, выполнить оптимизацию по выбранному критерию.

Выходные параметры:
- Коэффициент использования системы (utilization)  
- Среднее время ожидания в очереди  
- Среднее число требований в системе  
- Абсолютная пропускная способность  
- Относительная пропускная способность  

Критерии оптимизации (приняты в работе):  
- Среднее ожидание < 2 сек  
- Загрузка (utilization) > 0.7  
- Относительная пропускная способность > 0.95  

## Описание модели
- Поток запросов: экспоненциально распределённые интервалы времени (среднее μ_A).  
- Ресурсы:  
  - `preprocessors` — предобработка/валидация запроса (быстрый шаг 0.1–0.2 сек),  
  - `gpu_workers` — GPU‑воркеры (основной ресурс инференса), каждый обрабатывает один запрос.  
- Обслуживание (инференс): экспоненциальное распределение со средним μ_s.  
- Времена и метрики измеряются в секундах.

## Алгоритм работы клиента
1. Запрос поступает и проходит предобработку/валидацию (`preprocessors`).  
2. Встает в очередь к GPU‑воркеру (`gpu_workers`).  
3. Выполняется инференс (обслуживание) и запрос завершается.  

## Реализация
Полная реализация находится в ноутбуке `lab3/solution.ipynb` и включает:  
- Определение ресурсов и процессов (SimPy),  
- Генератор поступления запросов,  
- Сбор метрик,  
- Функции запуска симуляции и вычисления метрик,  
- Поиск оптимального числа GPU‑воркеров,  
- Визуализацию результатов (графики).

## Теоретическая оценка нагрузки (M/M/s)
При μ_s = 1.5 сек и μ_A = 1.5 сек:  
- Интенсивность прибытия λ ≈ 1 / μ_A ≈ 0.6667 req/сек  
- Скорость обслуживания одним GPU‑воркером μ ≈ 1 / μ_s ≈ 0.6667 req/сек  
- Для s = 4: ρ = λ / (s·μ) ≈ 0.6667 / (4·0.6667) ≈ 0.25 (25%) — устойчивая система с невысокой загрузкой, малые очереди ожидаемы.

## Фактические результаты (по запуску `solution.ipynb`)
Параметры запуска: s=4 GPU‑воркера, 1 предобработчик, μ_s=1.5 сек (инференс), μ_A=1.5 сек (межприход), время моделирования 2000 сек, seed=42.

### Базовый прогон (s=4)
- Поступило запросов: 1341  
- Обработано: 1340  
- Коэффициент использования (ρ): 0.2648 (26.48%)  
- Среднее ожидание очереди: 0.0146 сек  
- Среднее время в системе: 1.7538 сек  
- Среднее число в системе: 1.0687  
- Абсолютная пропускная способность: 0.6700 req/сек  
- Относительная пропускная способность: 0.9993  

Интерпретация: система устойчива, очереди практически отсутствуют; загрузка невысокая (~26%).

### Оптимизация по числу GPU‑воркеров (s ∈ [2..8])
Результаты перебора:

```
s=2: util=0.517, wait=0.409 сек, relThr=0.998
s=3: util=0.353, wait=0.070 сек, relThr=1.000
s=4: util=0.265, wait=0.015 сек, relThr=0.999
s=5: util=0.212, wait=0.001 сек, relThr=0.999
s=6: util=0.177, wait=0.000 сек, relThr=0.999
s=7: util=0.152, wait=0.000 сек, relThr=0.999
s=8: util=0.133, wait=0.000 сек, relThr=0.999
```

Принятые ранее критерии (ожидание < 2 сек, использование > 0.7, относительная пропускная > 0.95) в данной нагрузке недостижимы из‑за ограничения по ρ>0.7: при λ≈μ и s≥2 загрузка неизбежно ниже 0.7. Это ожидаемо, так как ρ=λ/(s·μ).

Таким образом, для данного потока (μ_A=1.5 сек) разумный диапазон — s=2…3; s=4 избыточен (низкая загрузка ~26%).

## Выводы
- Модель микросервиса обработки изображений с параметрами варианта реализована в SimPy и даёт требуемые метрики.  
- При s=4 и равных средних μ_s=μ_A ожидается невысокая загрузка (~25%) и малые очереди.  
- Оптимизация по числу GPU‑воркеров позволяет подобрать минимальное s, удовлетворяющее SLA-порогам (ожидание, загрузка, пропускная способность).  
- Быстрый этап предобработки разгружает GPU‑воркеры от «мелких» операций.
